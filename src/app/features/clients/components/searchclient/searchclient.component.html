<div class="client-search-page">
  <div class="page-header">
    <div class="title-block">
      <div class="icon-circle">
        <mat-icon>people_alt</mat-icon>
      </div>
      <div>
        <h1>Client Search</h1>
        <p>Quickly find any client by name, contact details, ID, or status.</p>
      </div>
    </div>

    <div class="stats" *ngIf="clients.length">
      <span class="badge">Results: {{ clients.length }}</span>
    </div>
  </div>

  <mat-card class="client-search-card">
    <!-- Search Bar -->
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="search-form">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search clients</mat-label>
        <mat-icon matPrefix>search</mat-icon>
        <input
          matInput
          formControlName="searchText"
          placeholder="Type name, email, phone or client ID"
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="status-field">
        <mat-label>Status</mat-label>
        <mat-select formControlName="status">
          <mat-option value="all">All</mat-option>
          <mat-option value="active">Active</mat-option>
          <mat-option value="inactive">Inactive</mat-option>
        </mat-select>
      </mat-form-field>

      <button
        mat-raised-button
        color="primary"
        type="submit"
        class="search-btn"
        [disabled]="searchForm.invalid || isLoading"
      >
        <mat-icon>search</mat-icon>
        <span>Search</span>
      </button>

      <button
        mat-button
        type="button"
        class="clear-btn"
        (click)="clear()"
        [disabled]="isLoading"
      >
        Clear
      </button>
    </form>

    <div class="helper-text">
      Use any field – full or partial – to locate a client record.
    </div>

    <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>

    <!-- Results -->
    <div class="results" *ngIf="clients.length; else noResultsTpl">
      <table mat-table [dataSource]="clients" class="clients-table">

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Client </th>
          <td mat-cell *matCellDef="let c">
            <div class="client-main">
              <div class="avatar-circle">
                {{ c.name?.charAt(0) || '?' }}
              </div>
              <div class="client-text">
                <div class="client-name">{{ c.name }}</div>
                <div class="client-id">ID: {{ c.id }}</div>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef> Email </th>
          <td mat-cell *matCellDef="let c">{{ c.email }}</td>
        </ng-container>

        <ng-container matColumnDef="phone">
          <th mat-header-cell *matHeaderCellDef> Phone </th>
          <td mat-cell *matCellDef="let c">{{ c.phone || '—' }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef> Status </th>
          <td mat-cell *matCellDef="let c">
            <span
              class="status-pill"
              [ngClass]="{
                'active': c.status === 'active',
                'inactive': c.status === 'inactive'
              }"
            >
              {{ c.status || '—' }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="team">
          <th mat-header-cell *matHeaderCellDef> Team </th>
          <td mat-cell *matCellDef="let c">{{ c.team || '—' }}</td>
        </ng-container>

        <ng-container matColumnDef="createdAt">
          <th mat-header-cell *matHeaderCellDef> Created </th>
          <td mat-cell *matCellDef="let c">
            {{ c.createdAt | date: 'dd-MMM-yyyy' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let c" class="actions-cell">
            <button
              mat-stroked-button
              color="primary"
              class="small-btn"
              (click)="viewClient(c)"
            >
              <mat-icon>open_in_new</mat-icon>
              View
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns;"
          class="data-row"
        ></tr>
      </table>
    </div>

    <ng-template #noResultsTpl>
      <div class="empty-state" *ngIf="!isLoading && !clients.length && !errorMessage">
        <div class="empty-icon">
          <mat-icon>person_search</mat-icon>
        </div>
        <h3>No clients yet</h3>
        <p>Start typing above to search, or add a new client from the left menu.</p>
      </div>
    </ng-template>

    


    <ng-template #clientDetailsDialog>

  <div class="client-dialog">

    <!-- Header -->
    <div class="dialog-header">
      <div class="header-left">
        <div class="avatar">
          {{ selectedClientDetails?.client?.name?.charAt(0) || '?' }}
        </div>
        <div>
          <h2>Client Details</h2>
          <span class="client-id">
            ID: {{ selectedClientDetails?.client?.id }}
          </span>
        </div>
      </div>

      <button mat-icon-button (click)="closeDialog()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <mat-divider></mat-divider>

    <!-- Basic Info -->
    <section class="section">
      <h3>Basic Information</h3>

      <div class="info-grid">
        <div>
          <label>Name</label>
          <p>{{ selectedClientDetails?.client?.name }}</p>
        </div>

        <div>
          <label>Email</label>
          <p>{{ selectedClientDetails?.client?.email }}</p>
        </div>

        <div>
          <label>Phone</label>
          <p>{{ selectedClientDetails?.client?.contact || '—' }}</p>
        </div>

        <div>
          <label>Status</label>
          <span
            class="status-pill"
            [class.active]="selectedClientDetails?.client?.status === 'Active'"
          >
            {{ selectedClientDetails?.client?.status }}
          </span>
        </div>
      </div>
    </section>

    <!-- Assignments -->
    <section
      class="section"
      *ngIf="selectedClientDetails?.assignments?.length"
    >
      <h3>Assignments</h3>

      <table class="assign-table">
        <thead>
          <tr>
            <th>Assigned To</th>
            <th>Assigned At</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let a of selectedClientDetails.assignments">
            <td>{{ a.assignedTo }}</td>
            <td>{{ a.assignedAt | date:'dd-MMM-yyyy HH:mm' }}</td>
            <td><span class="badge">{{ a.status }}</span></td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Stats -->
    <section class="stats-row">
      <div class="stat-card">
        <mat-icon>description</mat-icon>
        <div>
          <strong>{{ selectedClientDetails?.documents?.length || 0 }}</strong>
          <span>Documents</span>
        </div>
      </div>

      <div class="stat-card">
        <mat-icon>receipt_long</mat-icon>
        <div>
          <strong>{{ selectedClientDetails?.invoices?.length || 0 }}</strong>
          <span>Invoices</span>
        </div>
      </div>

      <div class="stat-card">
        <mat-icon>payments</mat-icon>
        <div>
          <strong>{{ selectedClientDetails?.payments?.length || 0 }}</strong>
          <span>Payments</span>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <div class="dialog-footer">
      <button mat-stroked-button (click)="closeDialog()">Close</button>
    </div>

  </div>

</ng-template>

  </mat-card>
</div>
